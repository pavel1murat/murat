# -*- mode: tcl -*-
#------------------------------------------------------------------------------
# simulation stage 2 
# use default geometry
# declare volumes Coll31, Coll32, and PbarAbs as sensitive
# add new filter module
# 
# output structure:
# -----------------
# Begin processing the 78th record. run: 1002 subRun: 488421 event: 309 at 11-Sep-2017 17:18:25 CDT
# PRINCIPAL TYPE: Event                                                                            
# PROCESS NAME | MODULE_LABEL. | PRODUCT INSTANCE NAME | DATA PRODUCT TYPE................. | PRODUCT FRIENDLY TYPE | SIZE
# beamg4s1.... | g4run........ | ..................... | mu2e::StatusG4.................... | mu2e::StatusG4....... | ...-
# beamg4s1.... | generate..... | ..................... | std::vector<mu2e::GenParticle>.... | mu2e::GenParticles... | ...1
# beamg4s2.... | ts3CollFilter | Coll31............... | std::vector<mu2e::StepPointMC>.... | mu2e::StepPointMCs... | ...0
# beamg4s2.... | g4run........ | ..................... | mu2e::StatusG4.................... | mu2e::StatusG4....... | ...-
# beamg4s2.... | ts3CollFilter | virtualdetector...... | std::vector<mu2e::StepPointMC>.... | mu2e::StepPointMCs... | ..10
# beamg4s2.... | ts3CollFilter | ..................... | cet::map_vector<mu2e::SimParticle> | mu2e::SimParticlemv.. | ...3
# beamg4s2.... | ts3CollFilter | Coll32............... | std::vector<mu2e::StepPointMC>.... | mu2e::StepPointMCs... | ...0
# beamg4s2.... | ts3CollFilter | PbarAbs.............. | std::vector<mu2e::StepPointMC>.... | mu2e::StepPointMCs... | ...1
#------------------------------------------------------------------------------
#include "JobConfig/cd3/beam/beam_g4s2.fcl"

process_name                       : beamg4s2
services.scheduler.wantSummary     : true

source.fileNames : [ "/pnfs/mu2e/tape/phy-sim/sim/mu2e/cd3-beam-cs1-mubeam/0506a/art/00/01/sim.mu2e.cd3-beam-cs1-mubeam.0506a.001002_00488421.art" ]

physics : { @table::physics

    producers : { @table::physics.producers 
	g4run : { @table::physics.producers.g4run 
	    SDConfig             : { @table::physics.producers.g4run.SDConfig
		enableSD : [ virtualdetector, CRV , TS ] // activate just the explicitly listed SDs
		sensitiveVolumes : [ "Coll31", "Coll32", "PbarAbs"]
	    }
	}

	compressPVts3Coll : {
	    module_type: CompressPhysicalVolumes
	    volumesInput : "g4run"
	    hitInputs : []
	    particleInputs : [ "ts3CollFilter" ]
      }

    }

    filters : {  @table::physics.filters
	ts3CollFilter: {
	    module_type    : FilterG4Out
	    noInstanceName : true
	    mainHitInputs  : [ "g4run:Coll31", "g4run:Coll32", "g4run:PbarAbs" ]
	    extraHitInputs : [ "g4run:virtualdetector" ]
	    numSimParticleCollections : 1
	    vetoDaughters: []
	}
    }

    trigmubeam     : [ g4run, g4consistent, muonBeamFilter, compressPVmuonBeam ]
    trigcrv        : [ g4run, g4consistent, crvFilter     , compressPVCRV      ]
    trigts3Coll    : [ g4run, g4consistent, ts3CollFilter , compressPVts3Coll  ]

    g4StatusFilter : [ g4run, "!g4status", compressPVFull ]

#    trigger_paths  : [ trigmubeam, trigcrv, trigts3Coll, g4StatusFilter]
    trigger_paths  : [ trigts3Coll ]
    
    outputs       : [ ts3collout ] 
}

outputs : { # @table::outputs
   ts3collout : {
      module_type : RootOutput
      SelectEvents: { SelectEvents: ["trigts3Coll"] }
      outputCommands:   [ "drop *_*_*_*",
         "keep mu2e::GenParticles_*_*_*",
         "keep mu2e::GenEventCount_*_*_*",
         "keep mu2e::StatusG4_*_*_*",
         "keep *_ts3CollFilter_*_beamg4s2",
         "keep *_compressPVts3Coll_*_beamg4s2"
      ]
      fileName    : "sim.owner.cd3-beam-g4s2-ts3coll.version.sequencer.art"
   }
}


#------------------------------------------------------------------------------
# this is it
#------------------------------------------------------------------------------
