///////////////////////////////////////////////////////////////////////////////
// from here it looks that the fast component is close to 11%, not 20%
///////////////////////////////////////////////////////////////////////////////

/*
root [2] f_all->Integral(100,500)
(Double_t)9.92299436304063818e+01
root [3] f_fast->Integral(100,500)
(Double_t)1.14554964660606533e+01
*/

namespace {
  TF1* f_all;
  TF1* f_fast;
};

double  low_stat(double *X, double* P) {
  const double npt = 100;

  double data[2*npt] = {
5.81535,2.91123e-14,
13.5834,7.48089e-14,
21.3960,3.63539e-13,
35.5529,6.10776e-13,
42.0406,1.64539e-12,
52.4123,7.10553e-12,
65.2361,5.88131e-12,
71.8029,4.91824e-11,
84.6612,6.68211e-11,
97.4768,4.91526e-11,
102.493,8.98613e-12,
112.769,9.87331e-12,
124.322,9.87062e-12,
135.881,1.05919e-11,
143.523,4.52828e-12,
149.950,5.09462e-12,
162.822,8.36003e-12,
170.436,2.39297e-12,
184.552,2.22867e-12,
193.495,1.20637e-12,
203.789,1.71834e-12,
211.513,2.33489e-12,
223.116,4.73822e-12,
235.821,7.17087e-13,
243.436,2.05258e-13,
256.241,1.31051e-13,
262.643,1.03487e-13,
276.782,1.34115e-13,
285.763,1.24922e-13,
292.206,1.77954e-13,
299.933,2.53491e-13,
314.057,2.65653e-13,
320.504,3.96717e-13,
344.900,4.35739e-13,
364.156,4.35541e-13,
371.845,3.60545e-13,
380.832,3.69076e-13,
380.852,4.89895e-13,
393.658,3.12782e-13,
403.935,3.51869e-13,
414.172,2.19431e-13,
428.273,1.65260e-13,
435.960,1.33613e-13,
443.643,1.00643e-13,
453.878,6.12984e-14,
461.552,4.10336e-14,
471.808,3.39659e-14,
484.615,2.22040e-14,
494.862,1.59530e-14,
506.399,1.25960e-14,
516.644,8.83883e-15,
528.198,9.04743e-15,
534.605,7.66862e-15,
539.727,6.34853e-15,
549.985,5.38054e-15,
562.805,4.24820e-15,
571.780,3.60057e-15,
576.905,3.12482e-15,
580.744,2.64876e-15,
596.152,2.77577e-15,
597.417,2.14108e-15,
607.680,1.94774e-15,
614.091,1.73070e-15,
623.053,1.24349e-15,
630.744,1.05396e-15,
644.866,1.07877e-15,
655.123,8.92957e-16,
665.373,6.72571e-16,
679.485,5.97515e-16,
696.161,5.06332e-16,
706.421,4.39377e-16,
712.823,3.46962e-16,
725.667,3.81194e-16,
733.341,2.55174e-16,
743.604,2.32132e-16,
755.149,2.06240e-16,
766.667,1.25611e-16,
778.221,1.25577e-16,
784.644,1.34769e-16,
793.612,1.03934e-16,
805.137,6.95680e-17,
815.412,7.46537e-17,
825.675,6.79126e-17,
832.081,5.75628e-17,
839.764,4.33587e-17,
850.019,3.50535e-17,
860.270,2.70326e-17,
875.653,1.98836e-17,
885.893,1.29990e-17,
893.630,2.13332e-17,
905.165,1.64513e-17,
915.426,1.46167e-17,
924.386,1.00179e-17,
937.218,9.33035e-18,
947.494,1.02515e-17,
950.048,8.48732e-18,
961.578,6.09772e-18,
970.543,4.48580e-18,
979.520,3.98569e-18,
994.913,3.37756e-18
  };

  double x, x1, x2, y1, y2, xmin, xmax, f;

  x = X[0];

  xmin = data[0];
  xmax = data[2*(npt-1)];

  if ((x < xmin) || (x >= xmax)) {
    f = 0;
  }
  else {
//-----------------------------------------------------------------------------
// interpolate
//-----------------------------------------------------------------------------
    for (int i=0; i<npt; i++) {
      x1 = data[2*i];
      x2 = data[2*i+2];
      if ((x >= x1) && (x<x2)) {
	y1 = data[2*i+1];
	y2 = data[2*i+3];
	
	f = y1+(y2-y1)/(x2-x1)*(x-x1);
	break;
      }
    }
  }

  return f;
}

double  high_stat(double *X, double* P) {
  const double npt = 92;

  double data[2*npt] = {
2.91730,9.93677e-13,
11.7902,2.94158e-12,
21.9713,5.79711e-12,
32.1573,1.06755e-11,
43.6417,1.49888e-11,
53.8228,2.95392e-11,
62.7497,4.14716e-11,
71.6880,4.97027e-11,
85.7479,5.44238e-11,
99.8111,5.69590e-11,
113.883,5.32412e-11,
129.236,4.75675e-11,
145.878,3.71090e-11,
161.261,2.20710e-11,
177.909,1.57297e-11,
189.454,9.56853e-12,
199.694,8.35679e-12,
209.919,8.94526e-12,
220.132,1.14733e-11,
226.525,1.14749e-11,
232.973,5.44290e-12,
244.621,7.96969e-13,
257.501,2.24790e-13,
268.996,2.69421e-13,
276.641,3.95738e-13,
289.429,3.95852e-13,
300.921,4.96389e-13,
309.827,9.34986e-13,
325.169,9.78569e-13,
327.676,1.97226e-12,
336.626,2.01776e-12,
337.953,1.02412e-12,
346.905,1.02433e-12,
348.154,1.53876e-12,
357.097,1.72324e-12,
364.767,1.80326e-12,
371.216,8.36218e-13,
380.186,6.52248e-13,
391.677,8.36605e-13,
400.649,6.23704e-13,
412.186,4.24806e-13,
423.721,2.95952e-13,
436.530,2.20657e-13,
445.499,1.72112e-13,
454.483,1.09533e-13,
460.900,7.98290e-14,
472.437,5.43717e-14,
483.969,3.96313e-14,
485.071,4.55365e-13,
495.299,4.65884e-13,
496.753,4.14763e-14,
505.706,4.05574e-14,
509.603,1.75733e-14,
524.963,1.43432e-14,
528.567,3.55461e-13,
538.797,3.55543e-13,
542.895,9.55219e-15,
548.023,7.97281e-15,
567.225,6.08118e-15,
597.956,3.45818e-15,
613.318,2.75944e-15,
632.519,2.10474e-15,
646.598,1.75709e-15,
648.788,2.84312e-13,
656.461,2.84362e-13,
660.684,1.34005e-15,
676.041,1.14432e-15,
675.585,6.27593e-13,
684.536,6.27720e-13,
690.132,8.15493e-16,
714.450,6.08176e-16,
716.571,2.54315e-13,
725.522,2.54367e-13,
731.097,4.43348e-16,
746.457,3.61857e-16,
766.943,2.52148e-16,
787.430,1.75700e-16,
801.509,1.46680e-16,
815.599,1.06920e-16,
838.638,7.97364e-17,
852.724,6.08111e-17,
873.209,4.33429e-17,
884.731,3.61818e-17,
889.816,5.43573e-17,
897.491,5.31515e-17,
900.096,2.75949e-17,
916.738,2.15277e-17,
934.663,1.56937e-17,
952.589,1.14407e-17,
973.072,8.34080e-18,
987.150,7.12233e-18,
998.674,5.81267e-18
  };

  double x, x1, x2, xmin, xmax, y1, y2, f;

  x = X[0];

  xmin = data[0];
  xmax = data[2*(npt-1)];

  if ((x < xmin) || (x >= xmax)) {
    f = 0;
  }
  else {
//-----------------------------------------------------------------------------
// interpolate
//-----------------------------------------------------------------------------
    for (int i=0; i<npt; i++) {
      x1 = data[2*i];
      x2 = data[2*i+2];
      if ((x >= x1) && (x<x2)) {
	y1 = data[2*i+1];
	y2 = data[2*i+3];
	
	f = y1+(y2-y1)/(x2-x1)*(x-x1);
	break;
      }
    }
  }
//-----------------------------------------------------------------------------
// do not normalize to the same integral as the first function
//-----------------------------------------------------------------------------
//  f = f*2.72236756905691992/6.56366640206827127;

  return f;
}


//-----------------------------------------------------------------------------
// normalization: without a scale factor
// f_low_stat ->Integral(0,1000) = 2.72236756905691992e-09
// f_high_stat->Integral(0,1000) = 6.56366640206827127e-09
//-----------------------------------------------------------------------------
void plot_all() {

  f_low_stat  = new TF1("f_low_stat",low_stat,0,1000,0);

  f_high_stat = new TF1("f_high_stat",high_stat,0,1000,0);

//-----------------------------------------------------------------------------
// drawing
//-----------------------------------------------------------------------------
  f_low_stat->SetTitle("Pbars reaching TS (digitized from mu2e-3803)");
  f_low_stat->GetXaxis()->SetTitle("Ptot, MeV/c");
  f_low_stat->GetYaxis()->SetTitle("dN/dPtot/POT");
  f_low_stat->Draw();
  f_high_stat->SetLineColor(4);
  f_high_stat->Draw("same");


  TLegend* leg = new TLegend(0.5,0.8,0.7,0.88,"");

  leg->AddEntry(f_low_stat ,"low statistics" ,"f");
  leg->AddEntry(f_high_stat,"high statistics","f");


  leg->SetFillColor(0);
  leg->SetBorderSize(0);
  leg->Draw();
}  
