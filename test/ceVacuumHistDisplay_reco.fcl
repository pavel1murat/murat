# -*- mode: tcl -*-
# $Id: ceVacuumHistDisplay_reco.fcl,v 1.1 2013/08/27 04:49:35 murat Exp $
# $Author: murat $
# $Date: 2013/08/27 04:49:35 $
#
# Original author Rob Kutschke

#include "fcl/minimalMessageService.fcl"
#include "fcl/standardProducers.fcl"
#include "fcl/standardServices.fcl"

#                             Give this process a name
process_name : emoe

# Read events from a file (made by example 3)
source : {
    module_type : EmptyEvent
#    module_type : RootInput
    maxEvents   : 10000
    firstRun    : 1
}

outputs: {
    outfile : {
	module_type   :   RootOutput
	fileName      :   "debug_tracker_disk"
    }
}
#------------------------------------------------------------------------------
# services
#------------------------------------------------------------------------------
services : {
  message : @local::mf_debugging

  # Adjust configuration of message logger:
  # Load the standard message logger configuration:
  # Threshold=Info (from using mf_interactive). 
  # Limit of 5 per category; then exponential backoff.
#  message.destinations.log.default.limit : 5
    
    
  TFileService          : { fileName   : "muHitDisplay.root" }
  RandomNumberGenerator : { }

  user : {
      GeometryService        : { inputFile      : "Mu2eG4/test/geom_01_vacuum.txt"}
#      GeometryService        : { inputFile      : "Mu2eG4/test/geom_01.txt"}

      ConditionsService      : { conditionsfile : "Mu2eG4/test/conditions_01.txt" }
      GlobalConstantsService : { inputFile      : "Mu2eG4/test/globalConstants_01.txt" }
      G4Helper               : { }
      
      SeedService : @local::automaticSeeds
  }

} # close of services block
#------------------------------------------------------------------------------
# physics
#------------------------------------------------------------------------------
physics : {
# sequence: e-, e+, mu-, mu+
    producers : {
	# Generate the event
	generate: @local::generate
	
	# Run G4 and add hits to the event
	g4run : @local::g4run
	
	# Form StrawHits (SH).
	makeSH : 
	{
	    module_type          : MakeStrawHit
	    g4ModuleLabel        : g4run
	    diagLevel            : 0
	    minimumEnergy        : -1.
	    minimumAmplitude     : -1.
	    flightTimeCorrection : false
	    maxFullPrint         : 0
	    deadStrawList        : {
		verbosity   : 0
		deadDevices : [ ]
		deadSectors : [ ]
		deadLayers  : [ ]
		deadStraws  : [ ]
	    }
	}
	
	CaloReadoutHitsMaker : @local::CaloReadoutHitsMaker
	
	CaloCrystalHitsMaker : @local::CaloCrystalHitsMaker
	
    MakeStereoHits : @local::MakeStereoHits
    FlagStrawHits  : @local::FlagStrawHits
    FlagBkgHits    : @local::FlagBkgHits

    TrkPatRec1     : @local::TrkPatRecDownstreameMinus
    TrkPatRec2     : @local::TrkPatRecUpstreamePlus
    TrkPatRec3     : @local::TrkPatRecDownstreammuMinus
    TrkPatRec4     : @local::TrkPatRecUpstreammuPlus

    makeCaloCluster: {
      module_type           : MakeCaloClusterNew
      diagLevel             : 0
      generatorModuleLabel   : generate
      caloCrystalModuleLabel : CaloCrystalHitsMaker
      g4ModuleLabel          : g4run
      #caloReadoutModuleLabel: CaloReadoutHitsMaker
      caloClusterAlgorithm   : closest
      caloClusterSeeding     : energy
#     caloClusterSeeding    : time
      deltaTime              : 10.0 #ns
      nCryPerCrystal         : 1
      EnoiseCut              : 0.00 #MeV
      EclusterCut            : 0.00 #MeV  
      maxFullPrint           : 201
    }

    trkExtrapol : {
	  module_type                  : TrkExtrapol
	  diagLevel                    : 1
	  fitterModuleLabel            : TrkPatRec1
	  maxNumberStoresPoints        : 1
	  # MC truth finder, analyzer configuration
	  KalFitMC : {
	  }        
    }

    caloMatching : {
	module_type                  : CaloMatching
	diagLevel                    : 1
	fitterModuleLabel            : TrkPatRec1
	trkToCaloExtrapolModuleLabel : trkExtrapol
	caloClusterModuleLabel       : makeCaloCluster
	outPutNtup                   : 0
	caloClusterAlgorithm         : closest
	caloClusterSeeding           : energy
    }

    muHitDisplay: {
	module_type                  : MuHitDisplay # the class name
	debugBits                    : { }          # need for TAnaModule
	interactiveMode              : 1
	EnergyThresholdTrk           : 5.
	EnergyThresholdEMC           : 1.
	generatorModuleLabel         : generate
	g4ModuleLabel                : g4run
	strawHitMakerModuleLabel     : makeSH
	strawHitPosMakerModuleLabel  : MakeStereoHits
	strawHitFlagMakerModuleLabel : FlagStrawHits
	
	# if set to true, all hits will be displayed unconditionally
	# otherwise, display only hits with right flags
	displayBackgroundHits        : false
	useStereoHits                : true

	#      goodHitMask                 : ["EnergySelection","RadiusSelection","TimeSelection"]
	goodHitMask                  : ["EnergySelection", "RadiusSelection"]
	badHitMask                   : ["DeltaRay", "Isolated"]
	
	trackerStepPoints            : tracker
	minHits                      : 5
	clickToAdvance               : true
	printHits                    : false
	timeWindow                   : 100000.
	#      timeWindow           : 50.
    }

     PidDem : {
	 module_type       : ParticleID
	 fitterModuleLabel : TrkPatRec1
	 fitparticle       : 11
	 fitdirection      : 0
	 verbosity         : 0
	 diagLevel         : 1 
	 doDisplay         : false
     }
#------------------------------------------------------------------------------
# TCalm002 is a filter now, so it should be in trigger_paths
#------------------------------------------------------------------------------
	tcalm002 : { 
	    module_type                  : TCalm002
	    strawHitMaker                : makeSH
	    trkPatRecDem                 : TrkPatRec1
	    trkPatRecUem                 : TrkPatRec2
	    trkExtrapol                  : trkExtrapol
	    pidDem                       : PidDem
	    histFileName                 : "ceVacuumHistDisplay_reco_straw_drift.hist"
	    minTActive                   : 0.
	    debugBits                    : { 
		# bit0:1  
		# bit1:1 
		bit3:1
	    }
	}
    }
    
  analyzers: {
    # Look at the hits from G4.
  }
#------------------------------------------------------------------------------
# paths
#------------------------------------------------------------------------------
#  p1 : [makeCaloCluster, TrkPatRec1, TrkPatRec2, TrkPatRec3, TrkPatRec4]

  p1 : [makeCaloCluster, TrkPatRec1, TrkPatRec2]

  p2 : [
	generate, g4run, 
	makeSH,
	CaloReadoutHitsMaker, CaloCrystalHitsMaker,
	makeCaloCluster, 
	MakeStereoHits, FlagStrawHits, FlagBkgHits, 
	TrkPatRec1, TrkPatRec2,
	trkExtrapol, caloMatching
	, PidDem
        , tcalm002
	#	muHitDisplay
       ]

    #  e1 : [hitDisplay]
    e1 : []

    trigger_paths  : [p2]
    end_paths      : [e1]
}
#------------------------------------------------------------------------------
# print per event timing for ::event entry points
#------------------------------------------------------------------------------
#     services.Timing: { }
#------------------------------------------------------------------------------
# print timing summary
#------------------------------------------------------------------------------
# services.scheduler.wantSummary: true

physics.producers.generate.inputfile  : "Mu2eG4/test/genconfig_DownstreameMinus_vacuum.txt"
physics.producers.makeSH.diagLevel    : 0
physics.producers.makeSH.maxFullPrint : 2
services.user.SeedService.baseSeed         :  1
services.user.SeedService.maxUniqueEngines :  20
physics.producers.KalFitTest.KalFit.RemoveFailedFits : false
physics.producers.KalFitTest.KalFitMC.pureHits       : false

physics.producers.TrkPatRec1.addhits : false
physics.producers.TrkPatRec2.addhits : false

physics.producers.TrkPatRec1.KalFit.materialCorrection : false
physics.producers.TrkPatRec2.KalFit.materialCorrection : false

# physics.producers.g4run.trackingVerbosityLevel : 1
